# Specialty Malware Analysis

> This includes specialty classes of malware which differ from standard binary malware in their delivery mechanism or operation (i.e. maldocs, shellcode injection, PowerShell, VBS, etc.)


## Maldoc Analysis 

> A maldoc is a malicious document (Word, Excel, PowerPoint, etc.). If you don't have these applications installed then you cannot perform dynamic analysis, however this is very similar to standard binary dynamic analysis where you run the malware and see what happens in a sandboxed envrionment. Note, all Microsoft Office documents are really just `.zip` files with other files inside of them.

Malicious Excel document:
- these usually have a `.xlsm` (Excel document with macros enabled) extension
- first, transfer the file to Remnux machine and use `unzip <file>.xlsm` to extract included documents. These `.xlsm` files contain a host of data which can be extracted by unzipping them as all Office documents are just `.zip` files with other files inside of them.
- checkout any `.bin` files extracted as they contain binary bytes, which is usually VBA code used to program macros 
- next, analyse the malware with `oledump.py`, this program analyses OLE files and extracts useful information that it parses into streams of data (listed as directories, i.e. `A1` = stream 1)
- if the directory extracted by `oledump.py` has a `M` or `m` next to it then it's worth investigating because it contains an embedded macro 
- to get the hexdump of an interesting directory run `oledump.py -s <stream> <file>/xlsm`
	- i.e. `oledump.py -s 3 sheetsForFinancial.xlsm`
- this hexdump can reveal interesting strings, but to get them in a more readable format use the `-S` flag
	- i.e. `oledump.py -s 3 -S sheetsForFinancial.xlsm`
- to try an recover the full macro which has been embedded into the Excel worksheet, you can use the `--vbadecompresscorrupt` option 
	- i.e. `oledump.py -s 3 --vbadecompresscorrupt sheetsForFinancial.xlsm`
- if successful, you can then read this macro to determine to malware's functionality 


Malicious Word document:
- malware delivery in Microsoft Word can take two forms:
	- a) like with Excel documents malware can come in the form of macro-enabled `.docm` documents -- these can be analysed in the exact same way a macro-enabled Excel documents discussed above with `oledump.py`
	- b) in `.docx` Word documents 
- to analyse malware in `.docx` Word documents you can save the malware as a `.zip` file and extract the contents
- next, navigate to the "word" -> "_rels" directory and open the `settings.xml.refs` file in a text editor
- this is the file which points to the template which is going to be used to generate this Word document 
- usually Word downloads a template for the document and stores it in the user's Documents directory and the `Target=...` entry in the XML document points to this 
- however, this target does not have to be something on the local file system and attackers will abuse this to point to a web resource hosting malware (often a `.dotm` template with a malicious macro embedded in it). Thus, when the `.docx` document is run the malicious, macro embedded, template file will be pulled down and automatically run, just as if the original `.docx` document was a `.docm` document 


--- 

## Shellcode Analysis 

- ...


--- 

## Scripted Malware Delivery Mechanisms

- ...



--- 

### C# Malware

- ...




--- 

## Go Malware 

- ... 






----

## Mobile Malware Analysis 

